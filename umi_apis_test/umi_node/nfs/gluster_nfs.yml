
config:
    name: "request methods testcase with functions"
    # base_url: ${ENV(node_url)}
    base_url: ${get_node_url()}
    parameters:
        host_ip_01-host_ip_02: ${P(umi_node/data/glusterfs.csv)}
        share_dir-client-opt1-opt2:  ${P(umi_node/data/nfs.csv)}

teststeps:
-
    name: Gluster Volume Create Single
    variables:
        host01: "${get_host_once(host01)}"
    testcase: umi_node/glusterfs/module/volume_create_single.yml
-
    name: Gluster Nfs Service Status
    request:
        method: POST
        url: "/nfs/gluster/service/status"
        json: {}
    validate:
        - eq: ["status_code", 200]
-
    name: Gluster Nfs Service Init
    request:
        method: POST
        url: "/nfs/gluster/service/init"
        json: {}
    validate:
        - eq: ["status_code", 200]
-
    name: Gluster Nfs Service Enable
    request:
        method: POST
        url: "/nfs/gluster/service/enable"
        json: {}
    validate:
        - eq: ["status_code", 200]
-
    name: Gluster Nfs Share List
    request:
        method: POST
        url: "/nfs/gluster/share/list"
        json: {}
    validate:
        - eq: ["status_code", 200]
-
    name: Gluster Nfs Share Update
    request:
        method: POST
        url: "/nfs/gluster/share/update"
        json: {
          "vol_name": "pytest-vol-01",
          "share_dir": "$share_dir",
          "client": "$client",
          "options": "${switch_nfs_opts($opt1,$opt2)}"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Gluster Nfs Service Disable
    request:
        method: POST
        url: "/nfs/gluster/service/disable"
        json: {}
    validate:
        - eq: ["status_code", 200]

-
    name: Gluster Nfs Share Delete
    request:
        method: POST
        url: "/nfs/gluster/share/delete"
        json: {
          "vol_name": "pytest-vol-01",
          "share_dir": "$share_dir",
          "client": "$client",
        }
    validate:
        - eq: ["status_code", 200]

-
    name: Gluster Volume Delete
    testcase: umi_node/glusterfs/module/volume_delete.yml
    
