
config:
    name: "Cluster Volume Test"
    base_url: ${get_cluster_url()}
    parameters:
        req_host-host01-host02-host03: ${P(umi_cluster/data/storage.csv)}
    variables:
        vol_name: vol-01
        mode: Replica

teststeps:
-
    name: Cluster Volume Info
    request:
        method: POST
        url: "/cluster/volume/info"
        json: {
            "req_host": "$req_host",
            "vol_name": "all"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cluster Volume Status
    request:
        method: POST
        url: "/cluster/volume/status"
        json: {
            "req_host": "$req_host"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cluster Volume Create
    request:
        method: POST
        url: "/cluster/volume/create"
        json: {
            "req_host": "$req_host",
            "vol_name": "$vol_name",
            "remote_mnts": [
                "$host01:/data/${get_uuid_with_uuid_mark(uuid_01)}/$vol_name",
                "$host02:/data/${get_uuid_with_uuid_mark(uuid_02)}/$vol_name",
                "$host03:/data/${get_uuid_with_uuid_mark(uuid_03)}/$vol_name"
            ],
            "vol_type": "$mode",
            "vol_pattern": "3",
            "rdma": false
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cluster Volume Delete
    request:
        method: POST
        url: "/cluster/volume/delete"
        json: {
            "req_host": "$req_host",
            "vol_name": "$vol_name"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cluster Volume Start
    request:
        method: POST
        url: "/cluster/volume/start"
        json: {
            "req_host": "$req_host",
            "vol_name": "$vol_name"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cluster Volume Stop
    request:
        method: POST
        url: "/cluster/volume/stop"
        json: {
            "req_host": "$req_host",
            "vol_name": "$vol_name"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cluster Volume Extend
    request:
        method: POST
        url: "/cluster/volume/extend"
        json: {
            "req_host": "$req_host",
            "vol_name": "$vol_name",
            "remote_mnts": [
                "$host01:/data/${get_uuid_with_uuid_mark(uuid_01)}/$vol_name",
                "$host02:/data/${get_uuid_with_uuid_mark(uuid_02)}/$vol_name",
                "$host03:/data/${get_uuid_with_uuid_mark(uuid_03)}/$vol_name"
            ]
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cluster Volume Force Shirk
    request:
        method: POST
        url: "/cluster/volume/force_shirk"
        json: {
            "req_host": "$req_host",
            "vol_name": "$vol_name",
            "remote_mnts": [
                "$host01:/data/${get_uuid_with_uuid_mark(uuid_01)}/$vol_name",
                "$host02:/data/${get_uuid_with_uuid_mark(uuid_02)}/$vol_name",
                "$host03:/data/${get_uuid_with_uuid_mark(uuid_03)}/$vol_name"
            ]
        }
    validate:
        - eq: ["status_code", 200]

# -
#     name: Cluster Volume Config Export
#     request:
#         method: POST
#         url: "/cluster/volume/config/export"
#         json: {
#             "req_host": "$req_host"
#         }
#     validate:
#         - eq: ["status_code", 200]
# -
#     name: Cluster Volume Config Import
#     request:
#         method: POST
#         url: "/cluster/volume/config/import"
#         json: {
#             "req_host": "$req_host"
#         }
#     validate:
#         - eq: ["status_code", 200]
