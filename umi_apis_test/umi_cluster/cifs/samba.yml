
config:
    name: "CIFS TEST"
    base_url: ${get_cluster_url()}
    parameters:
        req_host-username-smbpasswd-sharename-create_mode-dir_mode-allow_hosts-deny_hosts:  ${P(umi_cluster/data/samba.csv)}

teststeps:
-
    name: Create Test Group
    request:
        method: POST
        url: "/cluster/user/local/group/update"
        json: {
          "req_host": "$req_host",
          "group": "$username", 
          "gid": 8889
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Create Test User
    request:
        method: POST
        url: "/cluster/user/local/user/update"
        json: {
          "req_host": "$req_host",
          "user": "$username", 
          "passwd": "$smbpasswd",
          "groups": ["$username"],
          "uid": 8889
        }
    validate:
        - eq: ["status_code", 200]

-
    name: Cifs Service Init
    request:
        method: POST
        url: "/cluster/cifs/service/init"
        json: {
          "req_host": "$req_host"
        }
    validate:
        - eq: ["status_code", 200]

-
    name: Cifs Service Status
    request:
        method: POST
        url: "/cluster/cifs/service/status"
        json: {
          "req_host": "$req_host"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cifs Service Enable
    request:
        method: POST
        url: "/cluster/cifs/service/enable"
        json: {
          "req_host": "$req_host"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cifs User Update
    request:
        method: POST
        url: "/cluster/cifs/user/update"
        json: {
          "req_host": "$req_host",
          "user": "$username",
          "passwd": "$smbpasswd"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cifs User List
    request:
        method: POST
        url: "/cluster/cifs/user/list"
        json: {
          "req_host": "$req_host"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cifs Share Update
    request:
        method: POST
        url: "/cluster/cifs/share/update"
        json: {
            "req_host": "$req_host",
            "name": "$sharename",
            "vol_name": "cifs_vol1",
            "share_dir": "/subdir-01",
            "acls": true,
            "allow_hosts": [ 
              "$allow_hosts" 
            ],
            "deny_hosts": [ 
              "$allow_hosts"  
            ],
            "guest_ok": true,
            "admin_users": [
              "$username"
            ],
            "read_list": [
              "$username"
            ],
            "write_list": [
              "$username"
            ],
            "create_mode": "$create_mode",
            "directory_mode": "$dir_mode"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cifs Share List
    request:
        method: POST
        url: "/cluster/cifs/share/list"
        json: {
            "req_host": "$req_host"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cifs Client Status
    request:
        method: POST
        url: "/cluster/cifs/client/status"
        json: {
            "req_host": "$req_host"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cifs Share Delete
    request:
        method: POST
        url: "/cluster/cifs/share/delete"
        json: {
          "req_host": "$req_host",
          "name": "$sharename"
        }
    validate:
        - eq: ["status_code", 200]
# api raise NotImplementedError
# -
#     name: Cifs Config Import
#     request:
#         method: POST
#         url: "/cluster/cifs/config/import"
#         json: {}
#     validate:
#         - eq: ["status_code", 200]
# -
#     name: Cifs Config Export
#     request:
#         method: POST
#         url: "/cifs/config/export"
#         json: {}
#     validate:
#         - eq: ["status_code", 200]
-
    name: Cifs User Delete
    request:
        method: POST
        url: "/cluster/cifs/user/delete"
        json: {
          "req_host": "$req_host",
          "user": "$username"
        }
    validate:
        - eq: ["status_code", 200]

-
    name: Sys User Delete
    request:
        method: POST
        url: "/cluster/user/local/user/delete"
        json: {
          "req_host": "$req_host",
          "user": "$username"
        }
    validate:
        - eq: ["status_code", 200]

-
    name: Sys Group Delete
    request:
        method: POST
        url: "/cluster/user/local/group/delete"
        json: {
          "req_host": "$req_host",
          "group": "$username"
        }
    validate:
        - eq: ["status_code", 200]
-
    name: Cifs Service Disable
    request:
        method: POST
        url: "/cluster/cifs/service/disable"
        json: {
          "req_host": "$req_host"
        }
    validate:
        - eq: ["status_code", 200]



