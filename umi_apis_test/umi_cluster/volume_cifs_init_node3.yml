config:
    name: ${ENV(umi_cluster_test_title)}
    base_url: ${ENV(umi_cluster_url)}

teststeps:

# 获取CIFS服务状态
-
    name: Cifs Service Status
    request:
        method: POST
        url: "/cluster/cifs/service/status"
        json: {
            "req_host": "127.0.0.1"
        }
    validate:
        - eq: ["status_code", 200]


# 初始化CIFS配置
-
    name: Cifs Service Init
    request:
        method: POST
        url: "/cluster/cifs/service/init"
        json: {
            "req_host": "127.0.0.1"
        }
    validate:
        - eq: ["status_code", 200]


# 关闭CIFS服务
-
    name: Cifs Service Disable
    request:
        method: POST
        url: "/cluster/cifs/service/disable"
        json: {
            "req_host": "127.0.0.1"
        }
    validate:
        - eq: ["status_code", 200]


# 开启CIFS服务
-
    name: Cifs Service Enable
    request:
        method: POST
        url: "/cluster/cifs/service/enable"
        json: {
            "req_host": "127.0.0.1"
        }
    validate:
        - eq: ["status_code", 200]


# 添加CIFS用户/修改用户密码 （执行前先确保系统中存在用户）
-
    name: Cifs User Update
    request:
        method: POST
        url: "/cluster/cifs/user/update"
        json: {
            "req_host": "127.0.0.1",
            "user": "usr-01",
            "passwd": "123456"
        }
    validate:
        - eq: ["status_code", 200]


# 获取CIFS用户信息列表
-
    name: Cifs User List
    request:
        method: POST
        url: "/cluster/cifs/user/list"
        json: {
            "req_host": "127.0.0.1"
        }
    validate:
        - eq: ["status_code", 200]


# 增加/更新CIFS共享
-
    name: Cifs Share Update
    request:
        method: POST
        url: "/cluster/cifs/share/update"
        json: {
            "req_host": "127.0.0.1",
            "name": "share-01",
            "vol_name": "umi_test",
            "share_dir": "/subdir-01",
            "glfs_api": true,
            "acls": true,
            "allow_hosts": [
                "172.18.123.0/24",
                "172.169.100.11"
            ],
            "deny_hosts": [
                "192.168.2.0/24"
            ],
            "guest_ok": true,
            "admin_users": [
                "admin-01"
            ],
            "read_list": [
                "ro-user-01"
            ],
            "write_list": [
                "rw-user-01"
            ],
            "create_mode": "420",
            "directory_mode": "493"
        }
    validate:
        - eq: ["status_code", 200]


# 获取CIFS共享信息列表
-
    name: Cifs User List
    request:
        method: POST
        url: "/cluster/cifs/share/list"
        json: {
            "req_host": "127.0.0.1"
        }
    validate:
        - eq: ["status_code", 200]


